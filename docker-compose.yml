services:
  snapcast:
    build:
      context: .
      dockerfile: Dockerfile.snapcast
    image: snapcast:latest
    container_name: snapserver
    hostname: snapcast
    restart: unless-stopped
    network_mode: host
    volumes:
      - ./snapserver.conf:/etc/snapserver.conf:ro
      - ./config:/config
      - ./data:/data
      - ./audio:/audio
    environment:
      - TZ=${TZ:-Europe/Berlin}
    command: >
      sh -c "
        mkdir -p /run/dbus &&
        rm -f /run/dbus/pid /run/dbus/dbus.pid &&
        dbus-daemon --system --fork &&
        sleep 1 &&
        avahi-daemon -D &&
        snapserver -c /etc/snapserver.conf
      "

  mpd:
    build:
      context: .
      dockerfile: Dockerfile.mpd
    image: mpd:latest
    container_name: mpd
    restart: unless-stopped
    network_mode: host
    volumes:
      - ./audio:/audio
      - ${MUSIC_LOSSLESS_PATH}:/music/Lossless:ro
      - ${MUSIC_LOSSY_PATH}:/music/Lossy:ro
      - ./mpd/config:/etc/mpd.d
      - ./mpd/playlists:/playlists
      - ./mpd/data:/data
    environment:
      - TZ=${TZ:-Europe/Berlin}
