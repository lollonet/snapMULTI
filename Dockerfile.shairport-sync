FROM alpine:3.23

RUN apk add --no-cache shairport-sync

RUN mkdir -p /audio

COPY config/shairport-sync.conf /etc/shairport-sync.conf
COPY scripts/airplay-entrypoint.sh /usr/local/bin/entrypoint.sh
COPY scripts/common/sanitize.sh /usr/local/bin/common/sanitize.sh
RUN chmod +x /usr/local/bin/entrypoint.sh /usr/local/bin/common/sanitize.sh

ENV DEVICE_NAME=""

# Use entrypoint script that sanitizes DEVICE_NAME to prevent command injection
ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]
